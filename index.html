<!DOCTYPE HTML>
<HTML>
    <HEAD>
        <title>chessNode</title>
        
        <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script src="/socket.io/socket.io.js"></script>
        
        <script>
            var socket = io.connect();
            
            //Globals
            BOARD_W = 900;
            BOARD_H = 900;
            SQUARE_W = 100;
            SQUARE_H = 100;
            SCORE_W = 200;
            SCORE_H = 900;
            
            var board;
            var boardCtx;
            
            var score;
            var scoreCtx;
            
            //Images
            var pieces = {
                pawns: {
                    w: new Image(),
                    b: new Image()
                },
                rooks: {
                    w: new Image(),
                    b: new Image()
                },
                bishops: {
                    w: new Image(),
                    b: new Image()
                },
                kings: {
                    w: new Image(),
                    b: new Image()
                },
                queens: {
                    w: new Image(),
                    b: new Image()
                }
            }
            pieces.pawns.w.src = "wPawn.png";
            pieces.pawns.b.src = "bPawn.png";
            pieces.rooks.w.src = "wRook.png";
            pieces.rooks.b.src = "bRook.png";
            pieces.bishops.w.src = "wBishop.png";
            pieces.bishops.b.src = "bBishop.png";
            pieces.kings.w.src = "wKing.png";
            pieces.kings.b.src = "bKing.png";
            pieces.queens.w.src = "wQueen.png";
            pieces.queens.b.src = "bQueen.png";
            
            var wood   = new Image();
            wood.src   = "wood.png";
            var sBoard = new Image();
            sBoard.src = "scoreBoard.png";
            var bTile  = new Image();
            bTile.src  = "bTile.png";
            var wTile  = new Image();
            wTile.src  = "wTile.png";
            
            jQuery(function($){
                $('#setNick').submit(function(e){
                    e.preventDefault();
                    socket.emit('login', $('#nickname').val(), function(data){
                        if(data) {
                            $('#nickWrap').hide();
                            $('#contentWrap').show();
                            init();
                        } else if (data.nick) {
                            $('#nickError').html("Something's wrong here. Someone may already be using that username.");
                        }
                    });
                    $('#nickname').val('');
                });
                socket.on('usernames', function(data) {});
            });
            
            function init() {
                board = document.getElementById("board");
                board.width = BOARD_W;
                board.height = BOARD_H;
                boardCtx = board.getContext("2d");
                
                score = document.getElementById("scores");
                score.width = SCORE_W;
                score.height = SCORE_H;
                scoreCtx = score.getContext("2d");
                
                boardCtx.drawImage(wood, 0, 0, BOARD_W, BOARD_H);
                
                drawBoard();
               drawScores();
                    setUp();
            }

            function drawBoard() {
                boardCtx.clearRect(50, 50, SQUARE_W*8, SQUARE_H*8);

                for (var r=0; r < 8; r++) {
                    for (var c = 0; c < 8; c++){
                        if ((r + c) % 2 == 0){
                            boardCtx.drawImage(wTile, c*SQUARE_W+50, r*SQUARE_H+50, SQUARE_W, SQUARE_H);
                        } else {
                            boardCtx.drawImage(bTile, c*SQUARE_W+50, r*SQUARE_H+50, SQUARE_W, SQUARE_H);
                        }
                    }
                }
            }
            
            function setUp() {
                var oP = onBoard.pawns;
                for (var c = 0; c < 8; c++) {
                    oP[oP.length] = {
                        color: white,
                        type: pawn,
                        posNum: c,
                        posLet: c
                    };
                }
            }

            function drawScores() {
                scoreCtx.drawImage(sBoard, 0, 0, SCORE_W, SCORE_H);
            }
        </script>
        
        <style>    
            #scores {
                margin-left: -5px;
            }
            
            body {
                background-color: #666666;
            }
            
            canvas {
                background-color: #FFF;
                margin: 0;
                padding: 0;
            }
        </style>
    </HEAD>
    <BODY>
        <div id="nickWrap" style="margin:50px;">
            <p>Enter a username:</p>
            <p id="nickError"></p>
            <form id="setNick">
            <input style="width:150px;" id="nickname">
            <input type="submit">
            </form>
        </div>
        
        <div id="contentWrap" style="display:none;">
            <center>
                <canvas id=board></canvas>
                <canvas id=scores></canvas>
            </center>
        </div>
    </BODY>
</HTML>